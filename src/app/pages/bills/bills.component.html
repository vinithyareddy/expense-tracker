<!-- bills.component.html -->
<div class="page-header">
  <h2 class="title">Bills & Budget</h2>
  <button class="add-bill-btn" (click)="openAddBillDialog()">
    <span class="plus-icon">ï¼‹</span> Add Bill
  </button>
</div>

<!-- Summary Cards -->
<div class="bills-container">
  <div class="container">
    <div class="widget-row">
      <!-- Total Due -->
      <div class="widget purple">
        <div class="widget-content">
          <p class="label">Total Due</p>
          <p class="value">â‚¹{{ totalDue }}</p>
          <p class="caption">â†— Due this month</p>
        </div>
      </div>

      <!-- Total Paid -->
      <div class="widget white">
        <div class="widget-content">
          <p class="label1">Total Paid</p>
          <p class="value">â‚¹{{ totalPaid }}</p>
          <p class="caption green">â†— Paid this month</p>
        </div>
      </div>

      <!-- Personal Loans -->
      <div class="widget white">
        <div class="widget-content">
          <p class="label1">Personal Loans</p>
          <p class="value" [ngClass]="{'loan-positive': personalLoanAmount >= 0, 'loan-negative': personalLoanAmount < 0}">
            â‚¹{{ personalLoanAmount < 0 ? personalLoanAmount : '+' + personalLoanAmount }}
          </p>
          <p class="caption blue">ğŸ‘¤ Outstanding amount</p>
        </div>
      </div>
    </div>
  </div>

 

  <!-- ğŸ•½ï¸ Filter Dropdown -->
  <mat-card>
    <div class="calendar-header">
      <button class="arrow-btn" (click)="prevMonth()">â†</button>
      <h2>{{ getMonthName(currentMonth) }} {{ currentYear }}</h2>
      <button class="arrow-btn" (click)="nextMonth()">â†’</button>
  
      <div class="month-selector">
        <select [(ngModel)]="currentMonth" (change)="refreshCalendar()">
          <option *ngFor="let m of months; let i = index" [value]="i">{{ m }}</option>
        </select>
        <select [(ngModel)]="currentYear" (change)="refreshCalendar()">
          <option *ngFor="let y of years" [value]="y">{{ y }}</option>
        </select>
      </div>
    </div>
  
    <div class="calendar">
      <div class="day" *ngFor="let day of weekDays">{{ day }}</div>
      <div
      class="date-cell"
      *ngFor="let day of calendarDays"
      [class.has-due]="day.dueBills.length > 0"
      (mouseenter)="hoveredDay = day"
      (mouseleave)="hoveredDay = null"
      (mousemove)="updateTooltipPosition($event)"
    >
      <span *ngIf="day.date.getTime() > 0">{{ day.date.getDate() }}</span>
    
      <div *ngIf="day.dueBills.length" class="due-label">
        {{ day.dueBills[0].name }}
      </div>
    
      <!-- Stylish floating tooltip -->
      <div
      class="custom-tooltip"
      *ngIf="hoveredDay === day && day.dueBills.length"
      [ngStyle]="{ top: tooltipY + 'px', left: tooltipX + 'px' }"
    >
      <div *ngFor="let bill of day.dueBills">
        <div class="tooltip-title">{{ bill.name }}</div>
        <div class="tooltip-amount">â‚¹{{ bill.amount }}</div>
        <div class="tooltip-date">ğŸ“… {{ bill.dueDate | date: 'mediumDate' }}</div>
      </div>
    </div>
    
    </div>
    
      
          </div>
  </mat-card>
s  
<!-- ğŸ•½ï¸ Filter Dropdown -->
<div class="filter-select-wrapper">
  <div class="select-icon-wrapper">
    <img src="assets/filter.jpg" alt="Filter Icon" class="select-icon" />
    <select [(ngModel)]="selectedBillType" class="filter-dropdown">
      <option value="credit">Credit Cards</option>
      <option value="regular">Regular Bills</option>
      <option value="loans">Personal Loans</option>
    </select>
  </div>
</div>


  <!-- ğŸ’³ Credit Card Bills -->
  <div *ngIf="selectedBillType === 'credit'" class="bill-section">
    <h3 class="section-heading">ğŸ’³ Credit Card Bills</h3>
    <div *ngFor="let bill of creditBills" class="card-widget">
      <div class="card-left">
        <div class="card-details">
          <div class="card-title"> ğŸ’³ {{ bill.name }}</div>
          <div class="card-subtext">Credit Type</div>
        </div>
      </div>
      <div class="card-right">
        <div class="card-amount">â‚¹{{ bill.amount }}</div>
        <div class="card-meta">
          <p>{{ bill.paidCount || 0 }} of {{ bill.installments }} installments</p>
          <p *ngIf="bill.dueDate">ğŸ“… Due {{ bill.dueDate | date:'MMM d, y' }}</p>
          <p *ngIf="bill.installments">Remaining Installments: {{ bill.installments - (bill.paidCount || 0) }}</p>
          <p *ngIf="bill.installments">Paid Amount: â‚¹{{ (bill.paidCount || 0) * bill.monthlyPayment || 0 }}</p>
        </div>
        <div class="action-buttons">
          <button class="mark-paid" (click)="markInstallmentPaid(bill)">Mark Installment Paid</button>
          <button class="delete-icon" (click)="deleteBill(bill)">
            ğŸ—‘ï¸
          </button>
        </div>
        
        
      </div>
    </div>
  </div>

  <!-- ğŸ§³ Regular Bills -->
  <div *ngIf="selectedBillType === 'regular'" class="bill-section">
    <h3 class="section-heading">ğŸ§³ Regular Bills</h3>
    <div *ngFor="let bill of regularBills" class="card-widget">
      <div class="card-left">
        <div class="card-details">
          <div class="card-title">ğŸ  {{ bill.name }}</div>
        </div>
      </div>
      <div class="card-right">
        <div class="card-amount">â‚¹{{ bill.amount }}</div>
        <div class="card-meta">
          <p>{{ bill.paidCount || 0 }} of {{ bill.installments }} installments</p>
          <p *ngIf="bill.dueDate">ğŸ“… Due {{ bill.dueDate | date:'MMM d, y' }}</p>
          <p *ngIf="bill.installments">Remaining Installments: {{ bill.installments - (bill.paidCount || 0) }}</p>
          <p *ngIf="bill.installments">Paid Amount: â‚¹{{ (bill.paidCount || 0) * bill.monthlyPayment || 0 }}</p>
        </div>
        <div class="action-buttons">
          <button class="mark-paid" (click)="markInstallmentPaid(bill)">Mark Installment Paid</button>
          <button class="delete-icon" (click)="deleteBill(bill)">
            ğŸ—‘ï¸
          </button>
        </div>
        
        
      </div>
    </div>
  </div>

  
<!-- ğŸ¤ Personal Loans -->
<div *ngIf="selectedBillType === 'loans'" class="bill-section">
  <h3 class="section-heading">ğŸ¤ Personal Loans</h3>
  <div *ngFor="let bill of loanBills; let i = index" class="card-widget">
    <div class="card-left">
      <div class="card-details">
        <div class="card-title">ğŸ¤ {{ bill.name }}</div>
        <div class="card-subtext">{{ bill.loanDirection === 'give' ? 'You gave a loan' : 'You took a loan' }}</div>
      </div>
    </div>
    <div class="card-right">
      <div class="card-amount">â‚¹{{ bill.amount }}</div>
      <div class="card-meta">
        <p>{{ bill.paidCount || 0 }} of {{ bill.installments }} installments</p>
        <p *ngIf="bill.dueDate">ğŸ“… Due {{ bill.dueDate | date:'MMM d, y' }}</p>
        <p *ngIf="bill.installments">Remaining Installments: {{ bill.installments - (bill.paidCount || 0) }}</p>
        <p *ngIf="bill.installments">Paid Amount: â‚¹{{ (bill.paidCount || 0) * bill.monthlyPayment || 0 }}</p>
      </div>
      <div class="action-buttons">
        <button class="mark-paid" (click)="markInstallmentPaid(bill)">Mark Installment Paid</button>
        <button class="delete-icon" (click)="deleteBill(bill)">
          ğŸ—‘ï¸
        </button>
      </div>
    </div>
  </div>
</div>
