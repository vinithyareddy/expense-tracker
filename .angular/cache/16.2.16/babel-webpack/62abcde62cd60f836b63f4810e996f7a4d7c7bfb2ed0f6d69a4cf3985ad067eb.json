{"ast":null,"code":"import { map, switchMap } from 'rxjs/operators';\nimport { of } from 'rxjs';\nimport firebase from 'firebase/compat/app';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/fire/compat/firestore\";\nimport * as i2 from \"./auth.service\";\nexport class FirestoreBillService {\n  constructor(afs, auth) {\n    this.afs = afs;\n    this.auth = auth;\n  }\n  get userId$() {\n    return this.auth.user$.pipe(map(user => user?.uid));\n  }\n  getBills() {\n    return this.userId$.pipe(switchMap(uid => {\n      if (!uid) return of([]);\n      return this.afs.collection(`users/${uid}/bills`).valueChanges({\n        idField: 'id'\n      });\n    }));\n  }\n  addBill(bill) {\n    return this.userId$.pipe(switchMap(uid => {\n      if (!uid) return of(null);\n      return this.afs.collection(`users/${uid}/bills`).add(bill);\n    }));\n  }\n  updateBill(bill) {\n    return this.userId$.pipe(switchMap(uid => {\n      if (!uid || !bill.id) {\n        console.warn('Missing UID or bill ID!', bill);\n        return of(null);\n      }\n      const updatedBill = {\n        ...bill,\n        paymentHistory: (bill.paymentHistory || []).map(d => d instanceof Date ? firebase.firestore.Timestamp.fromDate(d) : d)\n      };\n      return this.afs.doc(`users/${uid}/bills/${bill.id}`).update(updatedBill);\n    }));\n  }\n  deleteBill(billId) {\n    return this.userId$.pipe(switchMap(uid => {\n      if (!uid) return of(null);\n      return this.afs.doc(`users/${uid}/bills/${billId}`).delete();\n    }));\n  }\n  static {\n    this.ɵfac = function FirestoreBillService_Factory(t) {\n      return new (t || FirestoreBillService)(i0.ɵɵinject(i1.AngularFirestore), i0.ɵɵinject(i2.AuthService));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: FirestoreBillService,\n      factory: FirestoreBillService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["map","switchMap","of","firebase","FirestoreBillService","constructor","afs","auth","userId$","user$","pipe","user","uid","getBills","collection","valueChanges","idField","addBill","bill","add","updateBill","id","console","warn","updatedBill","paymentHistory","d","Date","firestore","Timestamp","fromDate","doc","update","deleteBill","billId","delete","i0","ɵɵinject","i1","AngularFirestore","i2","AuthService","factory","ɵfac","providedIn"],"sources":["/Users/vinithyareddy/Desktop/projects/my github projects/expense-tracker/src/app/services/firestore-bill.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { AngularFirestore } from '@angular/fire/compat/firestore';\nimport { AuthService } from './auth.service';\nimport { Bill } from '../models/bill.model';\nimport { map, switchMap } from 'rxjs/operators';\nimport { of } from 'rxjs';\nimport { BehaviorSubject } from 'rxjs';\nimport firebase from 'firebase/compat/app';\n\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class FirestoreBillService {\n  constructor(private afs: AngularFirestore, private auth: AuthService) {}\n\n  private get userId$() {\n    return this.auth.user$.pipe(map(user => user?.uid));\n  }\n\n  getBills() {\n    return this.userId$.pipe(\n      switchMap(uid => {\n        if (!uid) return of([]);\n        return this.afs.collection<Bill>(`users/${uid}/bills`).valueChanges({ idField: 'id' });\n      })\n    );\n  }\n\n  addBill(bill: Bill) {\n    return this.userId$.pipe(\n      switchMap(uid => {\n        if (!uid) return of(null);\n        return this.afs.collection<Bill>(`users/${uid}/bills`).add(bill);\n      })\n    );\n  }\n\n  updateBill(bill: Bill) {\n    return this.userId$.pipe(\n      switchMap(uid => {\n        if (!uid || !bill.id) {\n          console.warn('Missing UID or bill ID!', bill);\n          return of(null);\n        }\n  \n        const updatedBill = {\n          ...bill,\n          paymentHistory: (bill.paymentHistory || []).map((d: any) =>\n            d instanceof Date\n              ? firebase.firestore.Timestamp.fromDate(d)\n              : d\n          )\n        };\n  \n        return this.afs.doc<Bill>(`users/${uid}/bills/${bill.id}`).update(updatedBill);\n      })\n    );\n  }\n  \n  deleteBill(billId: string) {\n    return this.userId$.pipe(\n      switchMap(uid => {\n        if (!uid) return of(null);\n        return this.afs.doc<Bill>(`users/${uid}/bills/${billId}`).delete();\n      })\n    );\n  }\n}\n"],"mappings":"AAIA,SAASA,GAAG,EAAEC,SAAS,QAAQ,gBAAgB;AAC/C,SAASC,EAAE,QAAQ,MAAM;AAEzB,OAAOC,QAAQ,MAAM,qBAAqB;;;;AAM1C,OAAM,MAAOC,oBAAoB;EAC/BC,YAAoBC,GAAqB,EAAUC,IAAiB;IAAhD,KAAAD,GAAG,GAAHA,GAAG;IAA4B,KAAAC,IAAI,GAAJA,IAAI;EAAgB;EAEvE,IAAYC,OAAOA,CAAA;IACjB,OAAO,IAAI,CAACD,IAAI,CAACE,KAAK,CAACC,IAAI,CAACV,GAAG,CAACW,IAAI,IAAIA,IAAI,EAAEC,GAAG,CAAC,CAAC;EACrD;EAEAC,QAAQA,CAAA;IACN,OAAO,IAAI,CAACL,OAAO,CAACE,IAAI,CACtBT,SAAS,CAACW,GAAG,IAAG;MACd,IAAI,CAACA,GAAG,EAAE,OAAOV,EAAE,CAAC,EAAE,CAAC;MACvB,OAAO,IAAI,CAACI,GAAG,CAACQ,UAAU,CAAO,SAASF,GAAG,QAAQ,CAAC,CAACG,YAAY,CAAC;QAAEC,OAAO,EAAE;MAAI,CAAE,CAAC;IACxF,CAAC,CAAC,CACH;EACH;EAEAC,OAAOA,CAACC,IAAU;IAChB,OAAO,IAAI,CAACV,OAAO,CAACE,IAAI,CACtBT,SAAS,CAACW,GAAG,IAAG;MACd,IAAI,CAACA,GAAG,EAAE,OAAOV,EAAE,CAAC,IAAI,CAAC;MACzB,OAAO,IAAI,CAACI,GAAG,CAACQ,UAAU,CAAO,SAASF,GAAG,QAAQ,CAAC,CAACO,GAAG,CAACD,IAAI,CAAC;IAClE,CAAC,CAAC,CACH;EACH;EAEAE,UAAUA,CAACF,IAAU;IACnB,OAAO,IAAI,CAACV,OAAO,CAACE,IAAI,CACtBT,SAAS,CAACW,GAAG,IAAG;MACd,IAAI,CAACA,GAAG,IAAI,CAACM,IAAI,CAACG,EAAE,EAAE;QACpBC,OAAO,CAACC,IAAI,CAAC,yBAAyB,EAAEL,IAAI,CAAC;QAC7C,OAAOhB,EAAE,CAAC,IAAI,CAAC;;MAGjB,MAAMsB,WAAW,GAAG;QAClB,GAAGN,IAAI;QACPO,cAAc,EAAE,CAACP,IAAI,CAACO,cAAc,IAAI,EAAE,EAAEzB,GAAG,CAAE0B,CAAM,IACrDA,CAAC,YAAYC,IAAI,GACbxB,QAAQ,CAACyB,SAAS,CAACC,SAAS,CAACC,QAAQ,CAACJ,CAAC,CAAC,GACxCA,CAAC;OAER;MAED,OAAO,IAAI,CAACpB,GAAG,CAACyB,GAAG,CAAO,SAASnB,GAAG,UAAUM,IAAI,CAACG,EAAE,EAAE,CAAC,CAACW,MAAM,CAACR,WAAW,CAAC;IAChF,CAAC,CAAC,CACH;EACH;EAEAS,UAAUA,CAACC,MAAc;IACvB,OAAO,IAAI,CAAC1B,OAAO,CAACE,IAAI,CACtBT,SAAS,CAACW,GAAG,IAAG;MACd,IAAI,CAACA,GAAG,EAAE,OAAOV,EAAE,CAAC,IAAI,CAAC;MACzB,OAAO,IAAI,CAACI,GAAG,CAACyB,GAAG,CAAO,SAASnB,GAAG,UAAUsB,MAAM,EAAE,CAAC,CAACC,MAAM,EAAE;IACpE,CAAC,CAAC,CACH;EACH;;;uBAtDW/B,oBAAoB,EAAAgC,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,gBAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,WAAA;IAAA;EAAA;;;aAApBrC,oBAAoB;MAAAsC,OAAA,EAApBtC,oBAAoB,CAAAuC,IAAA;MAAAC,UAAA,EAFnB;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}