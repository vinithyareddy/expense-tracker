{"ast":null,"code":"import { map, switchMap } from 'rxjs/operators';\nimport { of, BehaviorSubject } from 'rxjs';\nimport firebase from 'firebase/compat/app';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/fire/compat/firestore\";\nimport * as i2 from \"./auth.service\";\nexport class FirestoreBillService {\n  constructor(afs, auth) {\n    this.afs = afs;\n    this.auth = auth;\n    // üîÅ Step 1: Add this at the top inside the class\n    this.billChangedSource = new BehaviorSubject(false);\n    this.billChanged$ = this.billChangedSource.asObservable();\n  }\n  // üîÅ Step 2: Create a method to trigger this change\n  notifyBillChanged() {\n    this.billChangedSource.next(true);\n  }\n  get userId$() {\n    return this.auth.user$.pipe(map(user => user?.uid));\n  }\n  getBills() {\n    return this.userId$.pipe(switchMap(uid => {\n      if (!uid) return of([]);\n      return this.afs.collection(`users/${uid}/bills`).valueChanges({\n        idField: 'id'\n      });\n    }));\n  }\n  addBill(bill) {\n    return this.userId$.pipe(switchMap(uid => {\n      if (!uid) return of(null);\n      return this.afs.collection(`users/${uid}/bills`).add(bill);\n    }));\n  }\n  updateBill(bill) {\n    return this.userId$.pipe(switchMap(uid => {\n      if (!uid || !bill.id) {\n        console.warn('Missing UID or bill ID!', bill);\n        return of(null);\n      }\n      const updatedBill = {\n        ...bill,\n        paymentHistory: (bill.paymentHistory || []).map(d => d instanceof Date ? firebase.firestore.Timestamp.fromDate(d) : d)\n      };\n      return this.afs.doc(`users/${uid}/bills/${bill.id}`).update(updatedBill);\n    }));\n  }\n  deleteBill(billId) {\n    return this.userId$.pipe(switchMap(uid => {\n      if (!uid) return of(null);\n      return this.afs.doc(`users/${uid}/bills/${billId}`).delete();\n    }));\n  }\n  static {\n    this.…µfac = function FirestoreBillService_Factory(t) {\n      return new (t || FirestoreBillService)(i0.…µ…µinject(i1.AngularFirestore), i0.…µ…µinject(i2.AuthService));\n    };\n  }\n  static {\n    this.…µprov = /*@__PURE__*/i0.…µ…µdefineInjectable({\n      token: FirestoreBillService,\n      factory: FirestoreBillService.…µfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["map","switchMap","of","BehaviorSubject","firebase","FirestoreBillService","constructor","afs","auth","billChangedSource","billChanged$","asObservable","notifyBillChanged","next","userId$","user$","pipe","user","uid","getBills","collection","valueChanges","idField","addBill","bill","add","updateBill","id","console","warn","updatedBill","paymentHistory","d","Date","firestore","Timestamp","fromDate","doc","update","deleteBill","billId","delete","i0","…µ…µinject","i1","AngularFirestore","i2","AuthService","factory","…µfac","providedIn"],"sources":["/Users/vinithyareddy/Desktop/projects/my github projects/expense-tracker/src/app/services/firestore-bill.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { AngularFirestore } from '@angular/fire/compat/firestore';\nimport { AuthService } from './auth.service';\nimport { Bill } from '../models/bill.model';\nimport { map, switchMap } from 'rxjs/operators';\nimport { of, BehaviorSubject } from 'rxjs';\nimport firebase from 'firebase/compat/app';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class FirestoreBillService {\n  constructor(private afs: AngularFirestore, private auth: AuthService) {}\n\n  // üîÅ Step 1: Add this at the top inside the class\n  private billChangedSource = new BehaviorSubject<boolean>(false);\n  billChanged$ = this.billChangedSource.asObservable();\n\n  // üîÅ Step 2: Create a method to trigger this change\n  notifyBillChanged() {\n    this.billChangedSource.next(true);\n  }\n\n  private get userId$() {\n    return this.auth.user$.pipe(map(user => user?.uid));\n  }\n\n  getBills() {\n    return this.userId$.pipe(\n      switchMap(uid => {\n        if (!uid) return of([]);\n        return this.afs.collection<Bill>(`users/${uid}/bills`).valueChanges({ idField: 'id' });\n      })\n    );\n  }\n\n  addBill(bill: Bill) {\n    return this.userId$.pipe(\n      switchMap(uid => {\n        if (!uid) return of(null);\n        return this.afs.collection<Bill>(`users/${uid}/bills`).add(bill);\n      })\n    );\n  }\n\n  updateBill(bill: Bill) {\n    return this.userId$.pipe(\n      switchMap(uid => {\n        if (!uid || !bill.id) {\n          console.warn('Missing UID or bill ID!', bill);\n          return of(null);\n        }\n\n        const updatedBill = {\n          ...bill,\n          paymentHistory: (bill.paymentHistory || []).map((d: any) =>\n            d instanceof Date\n              ? firebase.firestore.Timestamp.fromDate(d)\n              : d\n          )\n        };\n\n        return this.afs.doc<Bill>(`users/${uid}/bills/${bill.id}`).update(updatedBill);\n      })\n    );\n  }\n\n  deleteBill(billId: string) {\n    return this.userId$.pipe(\n      switchMap(uid => {\n        if (!uid) return of(null);\n        return this.afs.doc<Bill>(`users/${uid}/bills/${billId}`).delete();\n      })\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}