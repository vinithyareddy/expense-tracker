{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nlet MonthlyComponent = class MonthlyComponent {\n  constructor(firestore, afAuth, firestoreBillService) {\n    this.firestore = firestore;\n    this.afAuth = afAuth;\n    this.firestoreBillService = firestoreBillService;\n    this.monthlySummaries = [];\n    this.filterText = '';\n  }\n  ngOnInit() {\n    this.afAuth.authState.subscribe(user => {\n      if (!user) {\n        console.warn('User not authenticated!');\n        return;\n      }\n      this.firestore.collection('expenses', ref => ref.where('userId', '==', user.uid)).valueChanges().subscribe(data => {\n        const grouped = {};\n        data.forEach(expense => {\n          const date = expense.date?.toDate?.() ?? new Date(expense.date);\n          if (isNaN(date.getTime())) return;\n          const key = `${date.toLocaleString('default', {\n            month: 'short'\n          })} ${date.getFullYear()}`;\n          const isIncome = expense.category.toLowerCase() === 'income';\n          if (!grouped[key]) {\n            grouped[key] = {\n              received: 0,\n              spent: 0\n            };\n          }\n          if (isIncome) {\n            grouped[key].received += expense.amount;\n          } else {\n            grouped[key].spent += expense.amount;\n          }\n        });\n        this.monthlySummaries = Object.entries(grouped).map(([monthYear, {\n          received,\n          spent\n        }]) => ({\n          monthYear,\n          received,\n          spent,\n          saved: received - spent\n        }));\n      });\n    });\n    this.firestoreBillService.billChanged$.subscribe(() => {\n      // ⏬ Call your logic again to refresh data\n      this.ngOnInit();\n    });\n  }\n  filteredSummaries() {\n    if (!this.filterText) return this.monthlySummaries;\n    const lower = this.filterText.toLowerCase();\n    return this.monthlySummaries.filter(summary => summary.monthYear.toLowerCase().includes(lower) || summary.received.toString().includes(lower) || summary.spent.toString().includes(lower) || summary.saved.toString().includes(lower));\n  }\n};\nMonthlyComponent = __decorate([Component({\n  selector: 'app-monthly',\n  templateUrl: './monthly.component.html',\n  styleUrls: ['./monthly.component.scss']\n})], MonthlyComponent);\nexport { MonthlyComponent };","map":{"version":3,"names":["Component","MonthlyComponent","constructor","firestore","afAuth","firestoreBillService","monthlySummaries","filterText","ngOnInit","authState","subscribe","user","console","warn","collection","ref","where","uid","valueChanges","data","grouped","forEach","expense","date","toDate","Date","isNaN","getTime","key","toLocaleString","month","getFullYear","isIncome","category","toLowerCase","received","spent","amount","Object","entries","map","monthYear","saved","billChanged$","filteredSummaries","lower","filter","summary","includes","toString","__decorate","selector","templateUrl","styleUrls"],"sources":["/Users/vinithyareddy/Desktop/projects/my github projects/expense-tracker/src/app/pages/monthly/monthly.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { AngularFirestore } from '@angular/fire/compat/firestore';\nimport firebase from 'firebase/compat/app';\nimport { getAuth } from 'firebase/auth';\nimport { AngularFireAuth } from '@angular/fire/compat/auth';\n\n\nexport interface Expense extends firebase.firestore.DocumentData {\n  id?: string;\n  date: string;\n  amount: number;\n  category: string;\n  description: string;\n  method: string;\n  location: string;\n  uid?: string; // 🔑 Optional if not already in schema\n}\n\ninterface MonthlySummary {\n  monthYear: string;\n  received: number;\n  spent: number;\n  saved: number;\n}\n\n@Component({\n  selector: 'app-monthly',\n  templateUrl: './monthly.component.html',\n  styleUrls: ['./monthly.component.scss']\n})\nexport class MonthlyComponent implements OnInit {\n  monthlySummaries: MonthlySummary[] = [];\n  filterText: string = '';\n\n  constructor(private firestore: AngularFirestore, private afAuth: AngularFireAuth, private firestoreBillService: FirestoreBillService) {}\n\n  ngOnInit(): void {\n    this.afAuth.authState.subscribe(user => {\n      if (!user) {\n        console.warn('User not authenticated!');\n        return;\n      }\n  \n      this.firestore.collection<Expense>('expenses', ref =>\n        ref.where('userId', '==', user.uid)\n      ).valueChanges().subscribe((data: Expense[]) => {\n        const grouped: { [monthYear: string]: { received: number; spent: number } } = {};\n  \n        data.forEach(expense => {\n          const date = (expense.date as any)?.toDate?.() ?? new Date(expense.date);\n          if (isNaN(date.getTime())) return;\n  \n          const key = `${date.toLocaleString('default', { month: 'short' })} ${date.getFullYear()}`;\n          const isIncome = expense.category.toLowerCase() === 'income';\n  \n          if (!grouped[key]) {\n            grouped[key] = { received: 0, spent: 0 };\n          }\n  \n          if (isIncome) {\n            grouped[key].received += expense.amount;\n          } else {\n            grouped[key].spent += expense.amount;\n          }\n        });\n  \n        this.monthlySummaries = Object.entries(grouped).map(([monthYear, { received, spent }]) => ({\n          monthYear,\n          received,\n          spent,\n          saved: received - spent\n        }));\n      });\n    });\n    this.firestoreBillService.billChanged$.subscribe(() => {\n      // ⏬ Call your logic again to refresh data\n      this.ngOnInit();\n    });\n  }\n\n  filteredSummaries(): MonthlySummary[] {\n    if (!this.filterText) return this.monthlySummaries;\n\n    const lower = this.filterText.toLowerCase();\n    return this.monthlySummaries.filter(summary =>\n      summary.monthYear.toLowerCase().includes(lower) ||\n      summary.received.toString().includes(lower) ||\n      summary.spent.toString().includes(lower) ||\n      summary.saved.toString().includes(lower)\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}